# Roadmap: Industrial Energy Synth (VST3, JUCE) — v1.0 (MVP)

Цель v1.0: монофонический VST3-синтезатор под Windows 10/11 (x64) для агрессивных индустриальных тембров ("ломаем звук"), но с жёстким следованием высоты MIDI-нотам (pitch остаётся нотой, а не хаосом). Основная DAW для тестов: Reaper; дополнительно: FL Studio, Cakewalk.

## Definition Of Done (v1.0)
- VST3 стабильно работает в Reaper (длительная сессия, автомейшн параметров, смена SR/Buffer).
- Обработка аудио: 32-bit float; sample rate и buffer size наследуются от хоста.
- MIDI Note On/Off + Velocity отрабатывают корректно; при экстремальных искажениях высота остаётся читаемой и следует MIDI.
- Способен уверенно выдавать характеры: "гул", "визг", "болгарка", при этом ноты читаемы; бас держит фундамент, лид пробивает микс.
- Моно, last-note priority, Glide On/Off + Time.
- 2 осциллятора (Saw/Square/Triangle) с Coarse/Fine/Phase/Detune; sync Osc2 → Osc1.
- Цепь разрушения (последовательно): Wavefold -> Hard Clip -> RingMod/FМ (переключаемо) -> Bitcrusher/SRR, с параметрами Drive/Amount/Mix (+ синхронизация к частоте ноты там, где применимо).
- Фильтр после искажений: LP/BP, резонанс до самовозбуждения, keytracking (вкл/выкл).
- 2 ADSR: Amp + Filter.
- Пресеты: встроенные factory (12–15) + пользовательские (сохранение/загрузка).
- UI: блоки Oscillators / Distortion / Filter / Envelopes / Output, управление только крутилками и переключателями.

## Архитектура (целевая на MVP)
- `AudioProcessorValueTreeState` (APVTS) как единый источник параметров и состояния.
- Моно-движок без `juce::Synthesiser` (или 1 voice), с явным note-stack и last-note priority.
- DSP блоки в фиксированном порядке: OscMix -> DestroyChain -> Filter -> AmpEnv -> Output.
- Везде где нужно: сглаживание параметров (минимум cutoff/gain/drive/mix/glide), `ScopedNoDenormals`.

## Этапы / Milestones

### M0. Скелет проекта и сборка (инфраструктура)
**Задачи**
- Создать JUCE-проект (CMake или Projucer) под VST3 (и опционально Standalone для отладки).
- Настроить сборку на Windows (VS2022), базовую структуру `Source/`.
- Добавить минимальный CI (опционально) или скрипт сборки.

**Артефакты**
- Репозиторий собирается в VST3 на Windows, плагин грузится в Reaper.

**Критерии**
- Пустой плагин проходит скан VST3 в Reaper/DAW, нет крашей при открытии/закрытии проекта.

---

### M1. Параметры и состояние (APVTS)
**Задачи**
- Специфицировать список параметров (ID, диапазоны, skew, единицы).
- Реализовать `getStateInformation`/`setStateInformation` через ValueTree/XML.
- Сформировать основу для пресетов (пока без UI).

**Критерии**
- Сохранение/загрузка проекта DAW восстанавливает все параметры 1:1.

---

### M2. Моно-синтез ядро: MIDI, нота, Glide
**Задачи**
- Обработка MIDI: note on/off, velocity, last-note priority (note stack).
- Glide/Portamento: On/Off + Time (экспоненциальная/линейная интерполяция частоты).
- Key tracking 100%: осцилляторы строго следуют текущей ноте/глайду.

**Критерии**
- В Reaper MIDI-ноты играются корректно, легато/перекрытия ведут себя по last-note, glide предсказуем.

---

### M3. Осцилляторы (2 шт) + Sync
**Задачи**
- Osc1/Osc2: формы Saw/Square/Triangle.
- Параметры: Coarse/Fine, Phase (стартовая/сброс), Detune (включая "агрессивный/нестабильный" режим).
- Sync Osc2 → Osc1.
- Микс осцилляторов (уровни или баланс).

**Критерии**
- Осцилляторы звучат стабильно по тону; sync даёт ожидаемые "визжащие" гармоники без потери высоты.

---

### M4. ADSR (Amp + Filter) и модуляции
**Задачи**
- Amp ADSR: Attack/Decay/Sustain/Release.
- Filter ADSR: Attack/Decay/Sustain/Release, глубина модуляции cutoff.
- Velocity → amp; Velocity → drive (опционально, с интенсивностью).

**Критерии**
- Нет кликов на огибающих при разумных настройках; velocity влияет как задумано.

---

### M5. Разрушение сигнала (DestroyChain v1)
**Цепь (последовательно)**
1. Wavefold
2. Hard Clipping
3. Ring Modulation или FM (переключаемо)
4. Bitcrusher / Sample Rate Reduction

**Задачи**
- Реализовать каждый блок с Drive/Amount/Mix (dry/wet) и параметрическим сглаживанием.
- Sync к частоте ноты: там где применимо (например, частота модулятора в ringmod/fm, частота SRR как музыкально связанная опция/режим).
- Сохранить принцип: "ломаем звук сильно, но pitch следует ноте".

**Критерии**
- При экстремальных настройках звук становится индустриально-шумным/механическим, но основная высота воспринимается и следует MIDI.

---

### M6. Фильтр после искажений (LP/BP) + самовозбуждение
**Задачи**
- LP/BP, резонанс вплоть до self-osc, стабильность на разных SR.
- Keytracking (On/Off) + amount (если нужно).
- Cutoff модулируется огибающей (M4).

**Критерии**
- Резонанс достигает самовозбуждения без неуправляемых скачков/крашей; keytracking работает ожидаемо.

---

### M7. UI/UX (основной интерфейс v1)
**Задачи**
- Разметка блоков: Oscillators / Distortion-Mod / Filter / Envelopes / Output.
- Крутилки и тумблеры без меню; читаемые подписи, логичные группы.
- Индустриальный тёмный стиль (железо/энергия/техника), без "EDM-гламура".
- Привязка контролов к APVTS (`SliderAttachment`, `ButtonAttachment`).

**Критерии**
- Все параметры доступны из UI, автомейшн работает, UI не лагает и не "прыгает" при обновлениях.

---

### M8. Пресеты (Factory + User)
**Задачи**
- Встроенные factory presets (12–15): Industrial Bass (3–5), Aggressive Lead (3–5), Drone/Noise Tone (3–5).
- User presets: сохранение/загрузка в папку (например `Presets/User/`), список в UI (без сложных меню).
- Совместимость состояний: пресет = snapshot APVTS.

**Критерии**
- Пресеты грузятся мгновенно и воспроизводимо; при обновлении версии не ломают старые проекты (минимум: стабильные Parameter IDs).

---

### M9. QA, оптимизация, релизный билд
**Задачи**
- Тесты в Reaper: длительный прогон, переключение SR/Buffer, стресс автомейшна, быстрый MIDI input.
- Smoke-тесты в FL Studio и Cakewalk.
- Оптимизация: исключить аллокации в аудио-потоке, денормалы, лишние ветвления, зиппер-ноиз.
- Финальная сборка VST3 + версия + changelog.

**Критерии**
- Нет крашей/зависаний, CPU в пределах разумного для моно-синта, поведение одинаковое между хостами.

## Риски и решения (важно держать в фокусе)
- **Pitch vs дисторшн**: многие виды разрушения легко превращают звук в "шум без ноты". Нужны осмысленные режимы синхронизации (ringmod/fm/srr) и аккуратные диапазоны параметров.
- **Алиасинг**: искажения множат спектр; без oversampling возможно "цифровое стекло". Для MVP можно жить с этим, но диапазоны и фильтрация должны быть подобраны, а oversampling оставить на v1.1+.
- **Резонанс/self-osc**: обеспечить стабильность фильтра на разных sample rate и при больших значениях резонанса.
- **Стабильные IDs**: Parameter IDs нельзя менять после появления пресетов/проектов.

## После v1.0 (backlog)
- Oversampling (опционально/авто) для цепи разрушения.
- Полифония.
- Доп. источники (noise), sub-osc, доп. модуляции (LFO).
- FX (reverb/delay), arpeggiator, MPE.
